<form id="configurationForm">
    {% for header in config %}
        <div class="row">
            <h5><i class="bi bi-caret-right-fill"></i> [{{ header }}]</h5>
            {% for key in config[header] %}
                <div class="form-group col-6">
                    <label for="{{key}}-id">{{ key }} - <small class="form-text text-muted">{{config[header][key].description}}</small></label>
                    {% if 'options' in config[header][key] %}
                    <select class="form-control" name="{{header}}.{{key}}" id="{{key}}-id" placeholder="{{key}}" value="{{config[header][key].value}}">
                        {% for option in config[header][key]['options'] %}
                        <option value="{{option}}">{{option}}</option>
                        {% endfor %}
                    </select>
                    {% elif config[header][key].value is number %}
                        <input type="number" class="form-control" name="{{header}}.{{key}}" id="{{key}}-id" placeholder="{{key}}" value="{{config[header][key].value}}">
                    {% else %}
                        <input type="text" class="form-control" name="{{header}}.{{key}}" id="{{key}}-id" placeholder="{{key}}" value="{{config[header][key].value}}">
                    {% endif %}
                </div>
            {% endfor %}
        </div>
        <br>
    {% endfor %}
    <button type="submit" class="btn btn-primary my-1">{{ 'Save configuration' if container_id is defined else 'Spawn new node' }}</button>
</form>

<script>
    {% if container_id is defined %}
        const container_id = '{{ container_id }}';
    {% else %}
        const container_id = null;
    {% endif %}

    const server_id = '{{ server_info._id }}'

    document.getElementById('configurationForm').addEventListener('submit', event => {
        event.preventDefault();
        const myFormData = new FormData(event.target);
        const formDataObj = Object.fromEntries(myFormData.entries());
        formDataObj.action = container_id == null ? "create-node" : "update-node-conf"
        const url = container_id == null ? window.location.href : `/api/server/${server_id}/${container_id}`
        $("#spinner").removeAttr('hidden');
        fetch(url, {
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            method: "POST",
            body: JSON.stringify(formDataObj)
        })
        .then((response) => response.text())
        .then((data)=> {
            console.log(data);
            $("#spinner").attr("hidden", true);

            $("#messageModalBody").html(data)
            new bootstrap.Modal($("#messageModal"), {}).show();
        })
        .catch((error) => { console.log(error); $("#spinner").attr("hidden", true); })
    });
</script>